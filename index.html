<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>quann dtraiii</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
    margin:0;
    height:100vh;
    background: radial-gradient(circle at top,#020024,#090979,#000);
    display:flex;
    justify-content:center;
    align-items:center;
    font-family:Arial,sans-serif;
    color:#fff;
}
.container{position:relative;text-align:center}
canvas{
    background:#050510;
    border-radius:18px;
    box-shadow:0 0 25px #00ffe0;
}
button{
    background:#00ffe0;
    border:none;
    padding:8px 18px;
    border-radius:12px;
    font-weight:bold;
    cursor:pointer;
}
.overlay{
    position:absolute;
    inset:0;
    background:rgba(0,0,0,.8);
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    z-index:5;
}
.big-text{
    font-size:48px;
    color:#ff4d4d;
    text-shadow:0 0 20px red;
    animation:shake .4s infinite;
}
.count{
    font-size:64px;
    text-shadow:0 0 20px #00ffe0;
    animation:pulse .8s infinite;
}
@keyframes pulse{
    0%{transform:scale(1)}
    50%{transform:scale(1.2)}
    100%{transform:scale(1)}
}
@keyframes shake{
    0%{transform:translateX(0)}
    25%{transform:translateX(-5px)}
    50%{transform:translateX(5px)}
    75%{transform:translateX(-5px)}
    100%{transform:translateX(0)}
}
.info{
    display:flex;
    justify-content:space-between;
    font-size:14px;
    margin-top:6px
}
</style>
</head>

<body>
<div class="container">
<h2>quann dtraii</h2>
<canvas id="game" width="360" height="360"></canvas>

<div class="info">
<div>Score: <span id="score">0</span></div>
<div>High: <span id="high">0</span></div>
</div>

<!-- START -->
<div class="overlay" id="startScreen">
<button onclick="startCountdown()">‚ñ∂ B·∫ÆT ƒê·∫¶U</button>
</div>

<!-- COUNTDOWN -->
<div class="overlay" id="countdown" style="display:none">
<div class="count" id="countText">3</div>
</div>

<!-- DEATH -->
<div class="overlay" id="deathScreen" style="display:none">
<div class="big-text"> ƒÇN C·ª®T R·ªíI CON CH√ì ∆†I</div>
</div>
</div>

<script>
    function vibrate(pattern){
    if(navigator.vibrate){
        navigator.vibrate(pattern);
    }
}

const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const box=20;

let snake,food,dir;
let score=0,speed=140;
let game=null,running=false;

let high=localStorage.getItem("snake_high")||0;
document.getElementById("high").innerText=high;

const eat=new Audio("https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.wav");
const dead=new Audio("https://assets.mixkit.co/sfx/preview/mixkit-player-losing-or-failing-2042.wav");

function rand(){
    return {x:Math.floor(Math.random()*18)*box,
            y:Math.floor(Math.random()*18)*box};
}

function reset(){
    snake=[{x:9*box,y:9*box}];
    food=rand();
    dir="RIGHT";
    score=0;
}

function startCountdown(){
    document.getElementById("startScreen").style.display="none";
    document.getElementById("countdown").style.display="flex";
    let c=3;
    document.getElementById("countText").innerText=c;
    const t=setInterval(()=>{
        c--;
        document.getElementById("countText").innerText=c;
        if(c===0){
            clearInterval(t);
            document.getElementById("countdown").style.display="none";
            startGame();
        }
    },1000);
}

function startGame(){
    reset();
    running=true;
    clearInterval(game);
    game=setInterval(draw,speed);
}

document.addEventListener("keydown",e=>{
    if(!running) return;
    if(e.key==="ArrowUp"&&dir!=="DOWN")dir="UP";
    if(e.key==="ArrowDown"&&dir!=="UP")dir="DOWN";
    if(e.key==="ArrowLeft"&&dir!=="RIGHT")dir="LEFT";
    if(e.key==="ArrowRight"&&dir!=="LEFT")dir="RIGHT";
});

function draw(){
    ctx.clearRect(0,0,360,360);

    ctx.fillStyle="red";
    ctx.fillRect(food.x,food.y,box,box);

    snake.forEach((p,i)=>{
        ctx.fillStyle=i==0?"#00ffe0":"#00bfa6";
        ctx.fillRect(p.x,p.y,box,box);
    });

    let h={...snake[0]};
    if(dir=="UP")h.y-=box;
    if(dir=="DOWN")h.y+=box;
    if(dir=="LEFT")h.x-=box;
    if(dir=="RIGHT")h.x+=box;

    if(h.x<0||h.y<0||h.x>=360||h.y>=360||
       snake.some((p,i)=>i>0&&p.x==h.x&&p.y==h.y)){
        return gameOver();
    }

    if(h.x==food.x&&h.y==food.y){
    score++;
    eat.play();
    vibrate(50); // üì≥ rung nh·∫π
    food=rand();
}
else{
        snake.pop();
    }

    snake.unshift(h);
    document.getElementById("score").innerText=score;
}

function gameOver(){
    clearInterval(game);
    running=false;
    dead.play();
    vibrate([200,100,200,100,400]); // üì≥ rung m·∫°nh li√™n t·ª•c


    if(score>high){
        high=score;
        localStorage.setItem("snake_high",high);
        document.getElementById("high").innerText=high;
    }

    document.getElementById("deathScreen").style.display="flex";

    // ‚è≥ ƒë·ª£i 3 gi√¢y ‚Üí ƒë·∫øm ng∆∞·ª£c ‚Üí ch∆°i l·∫°i
    setTimeout(()=>{
        document.getElementById("deathScreen").style.display="none";
        startCountdown();
    },3000);
}
</script>
</body>
</html>
